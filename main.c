/**
 *
 * Wang Wei (Nicholas3388)
 * 2018.04.15
 *
 * My Github page: https://github.com/Nicholas3388 
 *
 */

#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

#define PLAYER_SIZE			17
#define MAP_HEIGHT			40
#define MAP_WIDTH			64

//#define PLAYER_EDITING			// uncomment this macro to start test player sheet
#define PLAYER_ACTION		9		// modify this macro from 1~8 to test player sheet one by one

#define SPACE				"  "
#define COLOR_END			"\033[0m"
#define COLOR_RED			"\033[0;31;41m"
#define COLOR_BLACK			"\033[0;30;40m"
#define COLOR_GRAY			"\033[0;37;47m"
#define COLOR_BLUE			"\033[0;34;44m"
#define COLOR_YELLOW		"\033[0;33;43m"

typedef enum {
  INDEX_SPACE = 0,
  INDEX_RED = 1,
  INDEX_BLACK = 2,
  INDEX_GRAY = 3,
  INDEX_BLUE = 4,
  INDEX_YELLOW = 5,
} idx_color_t;

typedef enum {
  STAT_STANDBY = 0,
  STAT_START,
  STAT_SHOW_ENEMY,
} stat_machine_t;

static int current_status = STAT_STANDBY;
static char mario_map[MAP_HEIGHT][MAP_WIDTH] = {0};
static int show_enemy = 0;
static int is_jumping = 0;
static int up_or_down = 1;	// 0 is down, 1 is up

#if (PLAYER_ACTION == 1)
char mario_map[][PLAYER_SIZE] = {
  0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 2, 2, 2, 3, 3, 2, 3, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 2, 3, 2, 3, 3, 3, 2, 3, 3, 0, 0, 0, 0, 0, 0,
  0, 0, 2, 3, 2, 2, 3, 3, 3, 2, 3, 3, 0, 0, 0, 0, 0,
  0, 0, 2, 2, 3, 3, 3, 3, 2, 2, 2, 2, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 1, 1, 4, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 0, 0, 0, 0, 0,
  0, 1, 1, 1, 1, 4, 4, 4, 4, 1, 1, 1, 1, 0, 0, 0, 0,
  0, 3, 3, 1, 4, 5, 4, 4, 5, 4, 1, 1, 3, 0, 0, 0, 0,
  0, 3, 3, 3, 4, 4, 4, 4, 4, 4, 3, 3, 3, 0, 0, 0, 0,
  0, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 0, 0, 0, 0,
  0, 0, 0, 4, 4, 4, 0, 0, 4, 4, 4, 0, 0, 0, 0, 0, 0,
  0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0,
  0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0,
};
#elif (PLAYER_ACTION == 2)
char mario_map[][PLAYER_SIZE] = {
  0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 3, 3, 3, 0, 0, 0,
  0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 3, 3, 3, 0, 0, 0,
  0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 3, 0, 0, 0,
  0, 0, 0, 2, 2, 2, 3, 3, 2, 3, 0, 1, 1, 1, 0, 0, 0,
  0, 0, 2, 3, 2, 3, 3, 3, 2, 3, 3, 1, 1, 1, 0, 0, 0,
  0, 0, 2, 3, 2, 2, 3, 3, 3, 2, 3, 3, 1, 1, 0, 0, 0,
  0, 0, 2, 2, 3, 3, 3, 3, 2, 2, 2, 2, 1, 1, 0, 0, 0,
  0, 0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 1, 1, 0, 0, 0, 0,
  0, 0, 0, 1, 1, 4, 1, 1, 1, 4, 1, 1, 0, 0, 1, 0, 0,
  0, 0, 1, 1, 1, 1, 4, 1, 1, 1, 4, 0, 0, 1, 1, 0, 0,
  0, 3, 3, 1, 1, 4, 4, 4, 4, 4, 5, 4, 4, 1, 1, 0, 0,
  0, 3, 3, 4, 4, 4, 5, 4, 4, 4, 4, 4, 4, 1, 1, 0, 0,
  0, 0, 0, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 0, 0,
  1, 1, 1, 4, 4, 4, 4, 4, 4, 0, 0, 0, 0, 0, 0, 0, 0,
  1, 1, 1, 4, 4, 4, 4, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
};
#elif (PLAYER_ACTION == 3)
char mario_map[][PLAYER_SIZE] = {	// enemy left leg
  0, 0, 0, 0, 0, 0, 0, 5, 5, 5, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 5, 5, 5, 5, 5, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 5, 5, 5, 5, 5, 5, 5, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 5, 5, 5, 5, 5, 5, 5, 5, 5, 0, 0, 0, 0,
  0, 0, 0, 5, 2, 2, 5, 5, 5, 5, 5, 2, 2, 5, 0, 0, 0,
  0, 0, 5, 5, 5, 3, 2, 5, 5, 5, 2, 3, 5, 5, 5, 0, 0,
  0, 0, 5, 5, 5, 3, 2, 2, 2, 2, 2, 3, 5, 5, 5, 0, 0,
  0, 5, 5, 5, 5, 3, 2, 3, 5, 3, 2, 3, 5, 5, 5, 5, 0,
  0, 5, 5, 5, 5, 3, 3, 3, 5, 3, 3, 3, 5, 5, 5, 5, 0,
  0, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 0,
  0, 0, 5, 5, 5, 5, 3, 3, 3, 3, 5, 5, 5, 5, 5, 0, 0,
  0, 0, 2, 2, 0, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0, 0, 0,
  0, 2, 2, 2, 2, 2, 3, 3, 3, 3, 0, 2, 2, 0, 0, 0, 0,
  0, 2, 2, 2, 2, 2, 2, 2, 3, 3, 2, 2, 2, 2, 0, 0, 0,
  0, 0, 2, 2, 2, 2, 2, 2, 0, 2, 2, 2, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
};
#elif (PLAYER_ACTION == 4)
char mario_map[][PLAYER_SIZE] = {	// enemy right leg
  0, 0, 0, 0, 0, 0, 0, 5, 5, 5, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 5, 5, 5, 5, 5, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 5, 5, 5, 5, 5, 5, 5, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 5, 5, 5, 5, 5, 5, 5, 5, 5, 0, 0, 0, 0,
  0, 0, 0, 5, 2, 2, 5, 5, 5, 5, 5, 2, 2, 5, 0, 0, 0,
  0, 0, 5, 5, 5, 3, 2, 5, 5, 5, 2, 3, 5, 5, 5, 0, 0,
  0, 0, 5, 5, 5, 3, 2, 2, 2, 2, 2, 3, 5, 5, 5, 0, 0,
  0, 5, 5, 5, 5, 3, 2, 3, 5, 3, 2, 3, 5, 5, 5, 5, 0,
  0, 5, 5, 5, 5, 3, 3, 3, 5, 3, 3, 3, 5, 5, 5, 5, 0,
  0, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 0,
  0, 0, 5, 5, 5, 5, 3, 3, 3, 3, 5, 5, 5, 5, 5, 0, 0,
  0, 0, 0, 0, 0, 3, 3, 3, 3, 3, 3, 2, 2, 2, 0, 0, 0,
  0, 0, 0, 2, 2, 0, 3, 3, 3, 3, 2, 2, 2, 2, 2, 0, 0,
  0, 0, 2, 2, 2, 2, 3, 3, 3, 3, 2, 2, 2, 2, 2, 0, 0,
  0, 0, 0, 2, 2, 2, 2, 0, 2, 2, 2, 2, 2, 2, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
};
#elif (PLAYER_ACTION == 5)
//INDEX_SPACE = 0,
//INDEX_RED = 1,
//INDEX_BLACK = 2,
//INDEX_GRAY = 3,
//INDEX_BLUE = 4,
//INDEX_YELLOW = 5,
char mario_map[][PLAYER_SIZE] = {	// mario running
  0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 2, 2, 2, 3, 3, 2, 3, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 2, 3, 2, 3, 3, 3, 2, 3, 3, 0, 0, 0, 0, 0, 0,
  0, 0, 2, 3, 2, 2, 3, 3, 3, 2, 3, 3, 0, 0, 0, 0, 0,
  0, 0, 2, 2, 3, 3, 3, 3, 2, 2, 2, 2, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 1, 1, 4, 4, 4, 1, 1, 0, 0, 0, 0, 0, 0, 0,
  0, 3, 3, 1, 1, 4, 4, 4, 4, 1, 1, 1, 3, 3, 3, 0, 0,
  0, 3, 3, 1, 1, 4, 4, 5, 4, 1, 1, 1, 1, 3, 3, 0, 0,
  0, 3, 3, 1, 4, 4, 4, 4, 4, 4, 1, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 4, 4, 4, 4, 4, 4, 4, 4, 0, 0, 1, 0, 0, 0,
  0, 1, 1, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 0, 0, 0,
  0, 1, 1, 4, 4, 4, 0, 0, 4, 4, 4, 4, 1, 1, 0, 0, 0,
  0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
};
#elif (PLAYER_ACTION == 6)
char mario_map[][PLAYER_SIZE] = {	// mario running 2
  0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 2, 2, 2, 3, 3, 2, 3, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 2, 3, 2, 3, 3, 3, 2, 3, 3, 0, 0, 0, 0, 0, 0,
  0, 0, 2, 3, 2, 2, 3, 3, 3, 2, 3, 3, 0, 0, 0, 0, 0,
  0, 0, 2, 2, 3, 3, 3, 3, 2, 2, 2, 2, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 1, 1, 4, 4, 4, 1, 1, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 1, 1, 4, 4, 4, 4, 4, 1, 1, 3, 3, 0, 0, 0, 0,
  0, 0, 1, 1, 4, 3, 3, 3, 4, 1, 1, 1, 3, 0, 0, 0, 0,
  0, 0, 1, 4, 4, 3, 3, 3, 4, 4, 1, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 4, 4, 4, 3, 3, 4, 4, 4, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 4, 4, 4, 4, 4, 4, 4, 4, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 4, 4, 4, 4, 4, 4, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0,
};

#elif (PLAYER_ACTION == 7)
// enemy walking test
char enemy_walk_map1[][PLAYER_SIZE] = {	// enemy left leg
  0, 0, 0, 0, 0, 0, 0, 5, 5, 5, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 5, 5, 5, 5, 5, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 5, 5, 5, 5, 5, 5, 5, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 5, 5, 5, 5, 5, 5, 5, 5, 5, 0, 0, 0, 0,
  0, 0, 0, 5, 2, 2, 5, 5, 5, 5, 5, 2, 2, 5, 0, 0, 0,
  0, 0, 5, 5, 5, 3, 2, 5, 5, 5, 2, 3, 5, 5, 5, 0, 0,
  0, 0, 5, 5, 5, 3, 2, 2, 2, 2, 2, 3, 5, 5, 5, 0, 0,
  0, 5, 5, 5, 5, 3, 2, 3, 5, 3, 2, 3, 5, 5, 5, 5, 0,
  0, 5, 5, 5, 5, 3, 3, 3, 5, 3, 3, 3, 5, 5, 5, 5, 0,
  0, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 0,
  0, 0, 5, 5, 5, 5, 3, 3, 3, 3, 5, 5, 5, 5, 5, 0, 0,
  0, 0, 2, 2, 0, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0, 0, 0,
  0, 2, 2, 2, 2, 2, 3, 3, 3, 3, 0, 2, 2, 0, 0, 0, 0,
  0, 2, 2, 2, 2, 2, 2, 2, 3, 3, 2, 2, 2, 2, 0, 0, 0,
  0, 0, 2, 2, 2, 2, 2, 2, 0, 2, 2, 2, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
};
char enemy_walk_map2[][PLAYER_SIZE] = {	// enemy right leg
  0, 0, 0, 0, 0, 0, 0, 5, 5, 5, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 5, 5, 5, 5, 5, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 5, 5, 5, 5, 5, 5, 5, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 5, 5, 5, 5, 5, 5, 5, 5, 5, 0, 0, 0, 0,
  0, 0, 0, 5, 2, 2, 5, 5, 5, 5, 5, 2, 2, 5, 0, 0, 0,
  0, 0, 5, 5, 5, 3, 2, 5, 5, 5, 2, 3, 5, 5, 5, 0, 0,
  0, 0, 5, 5, 5, 3, 2, 2, 2, 2, 2, 3, 5, 5, 5, 0, 0,
  0, 5, 5, 5, 5, 3, 2, 3, 5, 3, 2, 3, 5, 5, 5, 5, 0,
  0, 5, 5, 5, 5, 3, 3, 3, 5, 3, 3, 3, 5, 5, 5, 5, 0,
  0, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 0,
  0, 0, 5, 5, 5, 5, 3, 3, 3, 3, 5, 5, 5, 5, 5, 0, 0,
  0, 0, 0, 0, 0, 3, 3, 3, 3, 3, 3, 2, 2, 2, 0, 0, 0,
  0, 0, 0, 2, 2, 0, 3, 3, 3, 3, 2, 2, 2, 2, 2, 0, 0,
  0, 0, 2, 2, 2, 2, 3, 3, 3, 3, 2, 2, 2, 2, 2, 0, 0,
  0, 0, 0, 2, 2, 2, 2, 0, 2, 2, 2, 2, 2, 2, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
};

#elif (PLAYER_ACTION == 8)
char mario_walk_map1[][PLAYER_SIZE] = {	// mario running
  0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 2, 2, 2, 3, 3, 2, 3, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 2, 3, 2, 3, 3, 3, 2, 3, 3, 0, 0, 0, 0, 0, 0,
  0, 0, 2, 3, 2, 2, 3, 3, 3, 2, 3, 3, 0, 0, 0, 0, 0,
  0, 0, 2, 2, 3, 3, 3, 3, 2, 2, 2, 2, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 1, 1, 4, 4, 4, 1, 1, 0, 0, 0, 0, 0, 0, 0,
  0, 3, 3, 1, 1, 4, 4, 4, 4, 1, 1, 1, 3, 3, 3, 0, 0,
  0, 3, 3, 1, 1, 4, 4, 5, 4, 1, 1, 1, 1, 3, 3, 0, 0,
  0, 3, 3, 1, 4, 4, 4, 4, 4, 4, 1, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 4, 4, 4, 4, 4, 4, 4, 4, 0, 0, 1, 0, 0, 0,
  0, 1, 1, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 0, 0, 0,
  0, 1, 1, 4, 4, 4, 0, 0, 4, 4, 4, 4, 1, 1, 0, 0, 0,
  0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
};
char mario_walk_map2[][PLAYER_SIZE] = {	// mario running 2
  0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 2, 2, 2, 3, 3, 2, 3, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 2, 3, 2, 3, 3, 3, 2, 3, 3, 0, 0, 0, 0, 0, 0,
  0, 0, 2, 3, 2, 2, 3, 3, 3, 2, 3, 3, 0, 0, 0, 0, 0,
  0, 0, 2, 2, 3, 3, 3, 3, 2, 2, 2, 2, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 1, 1, 4, 4, 4, 1, 1, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 1, 1, 4, 4, 4, 4, 4, 1, 1, 3, 3, 0, 0, 0, 0,
  0, 0, 1, 1, 4, 3, 3, 3, 4, 1, 1, 1, 3, 0, 0, 0, 0,
  0, 0, 1, 4, 4, 3, 3, 3, 4, 4, 1, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 4, 4, 4, 3, 3, 4, 4, 4, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 4, 4, 4, 4, 4, 4, 4, 4, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 4, 4, 4, 4, 4, 4, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0,
};

#elif (PLAYER_ACTION == 9)
static char mario_standby[PLAYER_SIZE][PLAYER_SIZE] = {
  0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 2, 2, 2, 3, 3, 2, 3, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 2, 3, 2, 3, 3, 3, 2, 3, 3, 0, 0, 0, 0, 0, 0,
  0, 0, 2, 3, 2, 2, 3, 3, 3, 2, 3, 3, 0, 0, 0, 0, 0,
  0, 0, 2, 2, 3, 3, 3, 3, 2, 2, 2, 2, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 1, 1, 4, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 0, 0, 0, 0, 0,
  0, 1, 1, 1, 1, 4, 4, 4, 4, 1, 1, 1, 1, 0, 0, 0, 0,
  0, 3, 3, 1, 4, 5, 4, 4, 5, 4, 1, 1, 3, 0, 0, 0, 0,
  0, 3, 3, 3, 4, 4, 4, 4, 4, 4, 3, 3, 3, 0, 0, 0, 0,
  0, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 0, 0, 0, 0,
  0, 0, 0, 4, 4, 4, 0, 0, 4, 4, 4, 0, 0, 0, 0, 0, 0,
  0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0,
  0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0,
};
static char mario_jumping[PLAYER_SIZE][PLAYER_SIZE] = {
  0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 3, 3, 3, 0, 0, 0,
  0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 3, 3, 3, 0, 0, 0,
  0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 3, 0, 0, 0,
  0, 0, 0, 2, 2, 2, 3, 3, 2, 3, 0, 1, 1, 1, 0, 0, 0,
  0, 0, 2, 3, 2, 3, 3, 3, 2, 3, 3, 1, 1, 1, 0, 0, 0,
  0, 0, 2, 3, 2, 2, 3, 3, 3, 2, 3, 3, 1, 1, 0, 0, 0,
  0, 0, 2, 2, 3, 3, 3, 3, 2, 2, 2, 2, 1, 1, 0, 0, 0,
  0, 0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 1, 1, 0, 0, 0, 0,
  0, 0, 0, 1, 1, 4, 1, 1, 1, 4, 1, 1, 0, 0, 1, 0, 0,
  0, 0, 1, 1, 1, 1, 4, 1, 1, 1, 4, 0, 0, 1, 1, 0, 0,
  0, 3, 3, 1, 1, 4, 4, 4, 4, 4, 5, 4, 4, 1, 1, 0, 0,
  0, 3, 3, 4, 4, 4, 5, 4, 4, 4, 4, 4, 4, 1, 1, 0, 0,
  0, 0, 0, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 0, 0,
  1, 1, 1, 4, 4, 4, 4, 4, 4, 0, 0, 0, 0, 0, 0, 0, 0,
  1, 1, 1, 4, 4, 4, 4, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
};
static char mario_running1[PLAYER_SIZE][PLAYER_SIZE] = {	// mario running
  0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 2, 2, 2, 3, 3, 2, 3, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 2, 3, 2, 3, 3, 3, 2, 3, 3, 0, 0, 0, 0, 0, 0,
  0, 0, 2, 3, 2, 2, 3, 3, 3, 2, 3, 3, 0, 0, 0, 0, 0,
  0, 0, 2, 2, 3, 3, 3, 3, 2, 2, 2, 2, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 1, 1, 4, 4, 4, 1, 1, 0, 0, 0, 0, 0, 0, 0,
  0, 3, 3, 1, 1, 4, 4, 4, 4, 1, 1, 1, 3, 3, 3, 0, 0,
  0, 3, 3, 1, 1, 4, 4, 5, 4, 1, 1, 1, 1, 3, 3, 0, 0,
  0, 3, 3, 1, 4, 4, 4, 4, 4, 4, 1, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 4, 4, 4, 4, 4, 4, 4, 4, 0, 0, 1, 0, 0, 0,
  0, 1, 1, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 0, 0, 0,
  0, 1, 1, 4, 4, 4, 0, 0, 4, 4, 4, 4, 1, 1, 0, 0, 0,
  0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
};
static char mario_running2[PLAYER_SIZE][PLAYER_SIZE] = {	// mario running 2
  0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 2, 2, 2, 3, 3, 2, 3, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 2, 3, 2, 3, 3, 3, 2, 3, 3, 0, 0, 0, 0, 0, 0,
  0, 0, 2, 3, 2, 2, 3, 3, 3, 2, 3, 3, 0, 0, 0, 0, 0,
  0, 0, 2, 2, 3, 3, 3, 3, 2, 2, 2, 2, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 1, 1, 4, 4, 4, 1, 1, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 1, 1, 4, 4, 4, 4, 4, 1, 1, 3, 3, 0, 0, 0, 0,
  0, 0, 1, 1, 4, 3, 3, 3, 4, 1, 1, 1, 3, 0, 0, 0, 0,
  0, 0, 1, 4, 4, 3, 3, 3, 4, 4, 1, 1, 0, 0, 0, 0, 0,
  0, 0, 0, 4, 4, 4, 3, 3, 4, 4, 4, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 4, 4, 4, 4, 4, 4, 4, 4, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 4, 4, 4, 4, 4, 4, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0,
};
static char enemy_walking1[PLAYER_SIZE][PLAYER_SIZE] = {	// enemy left leg
  0, 0, 0, 0, 0, 0, 0, 5, 5, 5, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 5, 5, 5, 5, 5, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 5, 5, 5, 5, 5, 5, 5, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 5, 5, 5, 5, 5, 5, 5, 5, 5, 0, 0, 0, 0,
  0, 0, 0, 5, 2, 2, 5, 5, 5, 5, 5, 2, 2, 5, 0, 0, 0,
  0, 0, 5, 5, 5, 3, 2, 5, 5, 5, 2, 3, 5, 5, 5, 0, 0,
  0, 0, 5, 5, 5, 3, 2, 2, 2, 2, 2, 3, 5, 5, 5, 0, 0,
  0, 5, 5, 5, 5, 3, 2, 3, 5, 3, 2, 3, 5, 5, 5, 5, 0,
  0, 5, 5, 5, 5, 3, 3, 3, 5, 3, 3, 3, 5, 5, 5, 5, 0,
  0, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 0,
  0, 0, 5, 5, 5, 5, 3, 3, 3, 3, 5, 5, 5, 5, 5, 0, 0,
  0, 0, 2, 2, 0, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0, 0, 0,
  0, 2, 2, 2, 2, 2, 3, 3, 3, 3, 0, 2, 2, 0, 0, 0, 0,
  0, 2, 2, 2, 2, 2, 2, 2, 3, 3, 2, 2, 2, 2, 0, 0, 0,
  0, 0, 2, 2, 2, 2, 2, 2, 0, 2, 2, 2, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
};
static char enemy_walking2[PLAYER_SIZE][PLAYER_SIZE] = {	// enemy right leg
  0, 0, 0, 0, 0, 0, 0, 5, 5, 5, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 5, 5, 5, 5, 5, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 5, 5, 5, 5, 5, 5, 5, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 5, 5, 5, 5, 5, 5, 5, 5, 5, 0, 0, 0, 0,
  0, 0, 0, 5, 2, 2, 5, 5, 5, 5, 5, 2, 2, 5, 0, 0, 0,
  0, 0, 5, 5, 5, 3, 2, 5, 5, 5, 2, 3, 5, 5, 5, 0, 0,
  0, 0, 5, 5, 5, 3, 2, 2, 2, 2, 2, 3, 5, 5, 5, 0, 0,
  0, 5, 5, 5, 5, 3, 2, 3, 5, 3, 2, 3, 5, 5, 5, 5, 0,
  0, 5, 5, 5, 5, 3, 3, 3, 5, 3, 3, 3, 5, 5, 5, 5, 0,
  0, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 0,
  0, 0, 5, 5, 5, 5, 3, 3, 3, 3, 5, 5, 5, 5, 5, 0, 0,
  0, 0, 0, 0, 0, 3, 3, 3, 3, 3, 3, 2, 2, 2, 0, 0, 0,
  0, 0, 0, 2, 2, 0, 3, 3, 3, 3, 2, 2, 2, 2, 2, 0, 0,
  0, 0, 2, 2, 2, 2, 3, 3, 3, 3, 2, 2, 2, 2, 2, 0, 0,
  0, 0, 0, 2, 2, 2, 2, 0, 2, 2, 2, 2, 2, 2, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
};
#endif


static void clean_map(void)
{
  for (int i = 0; i < MAP_HEIGHT; i++) {
    for (int j = 0; j < MAP_WIDTH; j++) {
      mario_map[i][j] = 0;
    }
  }
}

static void setup_player(void)
{
  int i, j;
  for (i = MAP_HEIGHT-PLAYER_SIZE; i < MAP_HEIGHT; i++) {
    for (j = 0; j < PLAYER_SIZE; j++) {
      mario_map[i][j] = mario_standby[i-MAP_HEIGHT+PLAYER_SIZE][j];
    }
  }
  
  for (i = 0; i < MAP_HEIGHT; i++) {
    for (j = 0; j < MAP_WIDTH; j++) {
      if (mario_map[i][j] == INDEX_SPACE) {
        printf(SPACE);
      } else if (mario_map[i][j] == INDEX_RED) {
        printf(COLOR_RED "  " COLOR_END);
      } else if (mario_map[i][j] == INDEX_BLACK) {
        printf(COLOR_BLACK "  " COLOR_END);
      } else if (mario_map[i][j] == INDEX_GRAY) {
        printf(COLOR_GRAY "  " COLOR_END);
      } else if (mario_map[i][j] == INDEX_BLUE) {
        printf(COLOR_BLUE "  " COLOR_END);
      } else if (mario_map[i][j] == INDEX_YELLOW) {
        printf(COLOR_YELLOW "  " COLOR_END);
      }
    }
    printf("\r\n");
  }
}

static void mario_run_to_center(void)
{
  int i, j, k = 0, l = 0;
  int enemy_step = 0;
  printf("\ec");
  for (i = MAP_HEIGHT-PLAYER_SIZE; i < MAP_HEIGHT; i++) {
    for (j = 0; j < PLAYER_SIZE; j++) {
      mario_map[i][j] = mario_running1[i-MAP_HEIGHT+PLAYER_SIZE][j];
    }
  }
  while (1) {
    ++k;
    for (i = 0; i < MAP_HEIGHT; i++) {
      for (j = 0; j < MAP_WIDTH; j++) {
        if (mario_map[i][j] == INDEX_SPACE) {
          printf(SPACE);
        } else if (mario_map[i][j] == INDEX_RED) {
          printf(COLOR_RED "  " COLOR_END);
        } else if (mario_map[i][j] == INDEX_BLACK) {
          printf(COLOR_BLACK "  " COLOR_END);
        } else if (mario_map[i][j] == INDEX_GRAY) {
          printf(COLOR_GRAY "  " COLOR_END);
        } else if (mario_map[i][j] == INDEX_BLUE) {
          printf(COLOR_BLUE "  " COLOR_END);
        } else if (mario_map[i][j] == INDEX_YELLOW) {
          printf(COLOR_YELLOW "  " COLOR_END);
        }
      }
      printf("\r\n");
    }
    clean_map();
    if (k == 15) {
      show_enemy = 1;
    }
    
    if (is_jumping == 0) {
      if (k % 2) {
        for (i = MAP_HEIGHT-PLAYER_SIZE; i < MAP_HEIGHT; i++) {
          for (j = 0; j < PLAYER_SIZE; j++) {
            mario_map[i][j] = mario_running1[i-MAP_HEIGHT+PLAYER_SIZE][j];
          }
        }
      } else {
        for (i = MAP_HEIGHT-PLAYER_SIZE; i < MAP_HEIGHT; i++) {
          for (j = 0; j < PLAYER_SIZE; j++) {
            mario_map[i][j] = mario_running2[i-MAP_HEIGHT+PLAYER_SIZE][j];
          }
        }
      }
    } else {
      printf(">>> jumping.. height=%d\r\n", l);
      if (up_or_down) {
        ++l;
      } else {
        --l;
      }
      
      for (i = MAP_HEIGHT-PLAYER_SIZE-l; i < MAP_HEIGHT-l; i++) {
        for (j = 0; j < PLAYER_SIZE; j++) {
          mario_map[i][j] = mario_jumping[i-MAP_HEIGHT+PLAYER_SIZE+l][j];
        }
      }
      if (l == MAP_HEIGHT-PLAYER_SIZE) {
        up_or_down = 0;
      }
      if (l == 0) {
        is_jumping = 0;
        up_or_down = 1;
      }
    }
    
    if (show_enemy == 1) {
      if (enemy_step % 2) {
        for (i = MAP_HEIGHT-PLAYER_SIZE; i < MAP_HEIGHT; i++) {
          for (j = MAP_WIDTH-PLAYER_SIZE-enemy_step; j < MAP_WIDTH-enemy_step; j++) {
            mario_map[i][j] = enemy_walking1[i-MAP_HEIGHT+PLAYER_SIZE][j-MAP_WIDTH+PLAYER_SIZE+enemy_step];
          }
        }
      } else {
      	for (i = MAP_HEIGHT-PLAYER_SIZE; i < MAP_HEIGHT; i++) {
          for (j = MAP_WIDTH-PLAYER_SIZE-enemy_step; j < MAP_WIDTH-enemy_step; j++) {
            mario_map[i][j] = enemy_walking2[i-MAP_HEIGHT+PLAYER_SIZE][j-MAP_WIDTH+PLAYER_SIZE+enemy_step];
          }
        }
      }
      enemy_step++;
    }
    
    if (enemy_step == 20) {
      is_jumping = 1;
    }
    printf("\r\nJust for fun:)\r\n2018.04.15\r\nWang Wei\r\n");
    if (enemy_step == MAP_WIDTH-PLAYER_SIZE) {
      enemy_step = 0;
    }
    usleep(120000);
    printf("\ec");
  }
}



int main(int argc, char *argv[])
{
  printf("\ec");
  //system("clear");
  int k = 0, j = 0, i = 0;

#ifdef PLAYER_EDITING
  // test player here
  for (i = 0; i < PLAYER_SIZE; i++) {
    for (j = 0; j < PLAYER_SIZE; j++) {
      if (mario_map[i][j] == INDEX_SPACE) {
        printf(SPACE);
      } else if (mario_map[i][j] == INDEX_RED) {
        printf(COLOR_RED "  " COLOR_END);
      } else if (mario_map[i][j] == INDEX_BLACK) {
        printf(COLOR_BLACK "  " COLOR_END);
      } else if (mario_map[i][j] == INDEX_GRAY) {
        printf(COLOR_GRAY "  " COLOR_END);
      } else if (mario_map[i][j] == INDEX_BLUE) {
        printf(COLOR_BLUE "  " COLOR_END);
      } else if (mario_map[i][j] == INDEX_YELLOW) {
        printf(COLOR_YELLOW "  " COLOR_END);
      }
    }
    printf("\r\n");
  }

#else
/*  char mario_map[PLAYER_SIZE][PLAYER_SIZE] = {0};
  for (i = 0; i < PLAYER_SIZE; i++) {
    for (j = 0; j < PLAYER_SIZE; j++) {
      mario_map[i][j] = enemy_walk_map1[i][j];
    }
  }
  while (++k <= 10) {
    for (i = 0; i < PLAYER_SIZE; i++) {
      for (j = 0; j < abs(k); j++) {
        printf("  ");
      }
      for (j = 0; j < PLAYER_SIZE; j++) {
        if (mario_map[i][j] == INDEX_SPACE) {
          printf(SPACE);
        } else if (mario_map[i][j] == INDEX_RED) {
          printf(COLOR_RED "  " COLOR_END);
        } else if (mario_map[i][j] == INDEX_BLACK) {
          printf(COLOR_BLACK "  " COLOR_END);
        } else if (mario_map[i][j] == INDEX_GRAY) {
          printf(COLOR_GRAY "  " COLOR_END);
        } else if (mario_map[i][j] == INDEX_BLUE) {
          printf(COLOR_BLUE "  " COLOR_END);
        } else if (mario_map[i][j] == INDEX_YELLOW) {
          printf(COLOR_YELLOW "  " COLOR_END);
        }
      }
      printf("\r\n");
    }
    if (k == 10) {
      k = -10;
    }
    if (k % 2) {
      for (i = 0; i < PLAYER_SIZE; i++) {
        for (j = 0; j < PLAYER_SIZE; j++) {
          mario_map[i][j] = enemy_walk_map1[i][j];
        }
      }
    } else {
      for (i = 0; i < PLAYER_SIZE; i++) {
        for (j = 0; j < PLAYER_SIZE; j++) {
          mario_map[i][j] = enemy_walk_map2[i][j];
        }
      }
    }
    usleep(200000);
    printf("\ec");
  }*/
  
  
  // run state machine
  while (1) {
  	switch (current_status) {
  	  case STAT_STANDBY: {
  	    setup_player();
  	    sleep(2);
  	    current_status = STAT_START;		// go to the other status
  	    break;
  	  }
  	  case STAT_START: {
  	    mario_run_to_center();
  	    //return 0;
  	  	break;
  	  }
  	  case STAT_SHOW_ENEMY: {
  	    //play_with_enemy();
  	    return 0;
  	    break;
  	  }
  	  default:
  	    printf(">>> error status, stop application!!\r\n");
  	    return -1;
  	}
  }
#endif	// #ifdef PLAYER_EDITING

  return 0;
}
